<!DOCTYPE html>
<html>
    <head>
        <!-- Benchmark function imports -->        
	<script src="Bezier.js"></script>
        <script src="CirclesRandomSize.js"></script>
        <script src="CirclesUniformSize.js"></script>
        <script src="FillText.js"></script>
        <script src="Image.js"></script>
        <script src="IsPointInPath.js"></script>
        <script src="MeasureText.js"></script>
        <script src="Rave.js"></script>
        <script src="StaticAsteroids.js"></script>
        <!-- Benchmark execution and timing -->
        <script>
            var times = [];
            var total = 0;

            function main() {
                var canvas = document.getElementById("cnv");
                var context = canvas.getContext("2d");
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                // select benchmark function
                var benchmark = location.search.match(/\?benchmark=(.*)/i)[1];
                var func;
                // select benchmark function
                switch (benchmark) {
                    case "CirclesUniformSize":
                        func = CirclesUniformSize;
                        break;
                    case "CirclesRandomSize":
                        func = CirclesRandomSize;
                        break;
                    case "FillText":
                        func = FillText;
                        break;
                    case "MeasureText":
                        func = MeasureText;
                        break;
                    case "IsPointInPath":
                        func = IsPointInPath;
                        break;
                    case "Rave":
                        func = Rave;
                        break;
                    case "Image":
                        func = ImageMark;
                        break;
                    case "Bezier":
                        func = Bezier;
                        break;
                    case "StaticAsteroids":
                        func = StaticAsteroids;
                        break;
                    default:
                        console.log(benchmark + " is not a recognized benchmark function");
                        return;
                }
                time(100, func, context);
            }

            // execute benchmark function, time
            function time(trials, func, context) {
                // build a recursive stack of rendering calls separated by timeouts
                (function loop(trials, trial, func, context) {
                    setTimeout(function() {
                        if (trial != 0) {
                            // get time, store in times array
                            var start = new Date().getTime();
                            var k = func(1000, context);
      	                    if (typeof k != "function") {
      	                       k = function(r) { r(); }
      	    		            }
      	                    k(function() {
      	                    	var end = new Date().getTime();
                              times[trials - trial] = end - start;
                              loop(trials, trial - 1, func, context);
      	                    });
                        // at the end of the stack, find the average
                        } else if (trial == 0) {
                            for (j = 0; j < trials; j++) {
                                total += times[j];
                            }

                            console.log("Average function execution time: " + total / trials);
                        } else
                            return;
                        }, 0);})(trials, trials, func, context);
            }
        </script>
        <style>
            body {
                margin: 0px;
                padding: 0px;
            }
            img {
                visibility: hidden;
            }
        </style>
    </head>
    <body onload="main()">
        <canvas id="cnv" width="100" height="100"></canvas>
    </body>
</html>
